<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoll-Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        :root {
            --primary: #1e3a8a; /* Dunkelblau f√ºr Zoll */
            --accent: #f59e0b;  /* Gold/Gelb f√ºr Akzente */
            --danger: #ef4444;
            --success: #10b981;
            --neutral: #64748b;
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: #1e293b;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            height: 85vh;
        }

        /* Sidebar Stats */
        .sidebar {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .stat-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #64748b;
        }

        .inventory-list {
            list-style: none;
            margin-top: 10px;
        }

        .inv-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #cbd5e1;
            font-size: 0.9rem;
        }

        .inv-item .status-icon {
            margin-left: 5px;
            cursor: help;
        }

        /* Main Game Area */
        .main-stage {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
        }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 15px;
        }

        .location-badge {
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .story-content {
            font-size: 1.2rem;
            line-height: 1.7;
            margin-bottom: 40px;
            flex-grow: 1;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .choice-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .choice-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .choice-card h4 {
            color: var(--primary);
            margin-bottom: 8px;
        }

        .choice-card p {
            font-size: 0.9rem;
            color: #64748b;
        }

        /* Ending Screen */
        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.98);
            z-index: 50;
            padding: 40px;
            display: none;
            animation: fadeIn 0.5s;
            overflow-y: auto;
        }

        .result-score {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin: 20px 0;
        }

        .score-breakdown {
            max-width: 600px;
            margin: 0 auto;
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
        }

        .score-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .btn-restart {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 8px;
            margin: 30px auto;
            display: block;
            cursor: pointer;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .game-layout { grid-template-columns: 1fr; height: auto; }
            .sidebar { order: 2; }
            .main-stage { order: 1; min-height: 500px; }
        }
    </style>
</head>
<body>
    <nav style="position: fixed; top: 0; left: 0; right: 0; z-index: 2000; padding: 15px 30px; background: rgba(30, 58, 138, 0.95); backdrop-filter: blur(10px); border-bottom: 2px solid #f59e0b; display: flex; gap: 30px; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
    <div style="font-size: 1.2rem; font-weight: 700; color: white;">ZOLL-SIMULATOR</div>
    <a href="index.html" style="color: #f59e0b; text-decoration: none; font-weight: 600;">‚Üê Zur√ºck zur Hauptseite</a>
</nav>

<div class="game-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="stat-box">
            <div class="stat-value" id="displayScore">0</div>
            <div class="stat-label">Zoll-Punkte</div>
        </div>
        
        <div class="stat-box">
            <div class="stat-value" id="displayCash" style="color: var(--success)">2000‚Ç¨</div>
            <div class="stat-label">Budget</div>
        </div>

        <div class="stat-box">
            <div class="stat-label" style="text-align: left; margin-bottom: 10px;">Inventar</div>
            <ul class="inventory-list" id="inventoryList">
                <!-- Items injected via JS -->
            </ul>
        </div>

        <div class="stat-box" style="background: #fffbeb; border-color: #fcd34d;">
            <div class="stat-label" style="color: #b45309;">Dokumente</div>
            <div id="docStatus" style="font-weight: bold; margin-top: 5px;">Keine</div>
        </div>
    </aside>

    <!-- Main Game Area -->
    <main class="main-stage">
        <div class="stage-header">
            <div class="location-badge" id="locationBadge">Ort: Z√ºrich</div>
            <div style="font-size: 0.9rem; color: #94a3b8;">Schritt <span id="stepCount">1</span>/10</div>
        </div>

        <div id="gameContent">
            <h2 id="storyTitle" style="margin-bottom: 15px; color: var(--primary);">Einkaufsbummel</h2>
            <div class="story-content" id="storyText">
                Lade Spiel...
            </div>
            <div class="choices-grid" id="choicesContainer">
                <!-- Buttons injected here -->
            </div>
        </div>

        <!-- Result Overlay -->
        <div class="overlay" id="resultOverlay">
            <h1 style="text-align: center; margin-bottom: 10px;">Auswertung</h1>
            <p style="text-align: center; color: #64748b;" id="resultTitle">Dein Ergebnis</p>
            
            <div class="result-score" id="finalScoreDisplay">0 Pkt</div>
            
            <div class="score-breakdown" id="scoreBreakdown">
                <!-- Rows injected here -->
            </div>

            <div style="margin-top: 30px; line-height: 1.6; font-size: 0.95rem; color: #334155;" id="educationalText">
            </div>

            <button class="btn-restart" onclick="game.start()">Neue Reise</button>
        </div>
    </main>
</div>

<script>
    /**
     * GAME ENGINE
     * * Mechanics:
     * - Score: Measures how well you played the game (strategy + legality).
     * - Cash: You start with budget. Fines reduce this. Saving money on tax increases score, but risking fines decreases it massively.
     * - Hidden Flags: Tracks if you have receipts, where items are hidden, etc.
     */

    const game = {
        state: {
            score: 0,
            cash: 2000,
            step: 1,
            inventory: [],
            flags: {}, // e.g., 'has_receipts', 'watch_worn', 'meat_hidden'
            history: [] // To track decisions for the end screen
        },

        init() {
            this.start();
        },

        start() {
            this.state = {
                score: 500, // Start points
                cash: 1500, // Remaining budget after shopping
                step: 1,
                inventory: [
                    { name: "Laptop", val: 900, type: "tech" },
                    { name: "Goldkette", val: 550, type: "jewelry" },
                    { name: "K√§se & Fleisch", val: 60, type: "food" }
                ],
                flags: {
                    has_receipts: false,
                    knows_limit: false
                },
                history: []
            };
            
            document.getElementById('resultOverlay').style.display = 'none';
            this.updateUI();
            this.loadScene('scene_shop_checkout');
        },

        updateUI() {
            document.getElementById('displayScore').innerText = this.state.score;
            document.getElementById('displayCash').innerText = this.state.cash + '‚Ç¨';
            document.getElementById('stepCount').innerText = this.state.step;
            
            const invList = document.getElementById('inventoryList');
            invList.innerHTML = '';
            
            // Generate Inventory List
            this.state.inventory.forEach(item => {
                let statusIcon = '';
                if (this.state.flags['hide_' + item.type]) statusIcon = 'üïµÔ∏è (Versteckt)';
                else if (this.state.flags['wear_' + item.type]) statusIcon = 'üëï (Getragen)';
                
                const li = document.createElement('li');
                li.className = 'inv-item';
                li.innerHTML = `
                    <span>${item.name}</span>
                    <span style="font-size:0.8em; color:#64748b;">${item.val}‚Ç¨ ${statusIcon}</span>
                `;
                invList.appendChild(li);
            });

            // Doc Status
            const docStatus = document.getElementById('docStatus');
            if (this.state.flags.has_receipts) {
                docStatus.innerHTML = '<span style="color:green"><i class="fas fa-check"></i> Vorhanden</span>';
            } else if (this.state.flags.receipts_thrown) {
                docStatus.innerHTML = '<span style="color:red"><i class="fas fa-trash"></i> Weggeworfen</span>';
            } else {
                docStatus.innerHTML = '<span style="color:orange">Nicht gefragt</span>';
            }
        },

        loadScene(sceneId) {
            const scene = scenarios[sceneId];
            if (!scene) return console.error("Scene missing:", sceneId);

            document.getElementById('storyTitle').innerText = scene.title;
            document.getElementById('locationBadge').innerText = "Ort: " + scene.location;
            document.getElementById('storyText').innerHTML = scene.text;

            const grid = document.getElementById('choicesContainer');
            grid.innerHTML = '';

            scene.choices.forEach(choice => {
                // Condition check
                if (choice.condition && !choice.condition(this.state)) return;

                const card = document.createElement('div');
                card.className = 'choice-card';
                card.innerHTML = `<h4>${choice.label}</h4><p>${choice.desc || ''}</p>`;
                card.onclick = () => this.makeChoice(choice);
                grid.appendChild(card);
            });
        },

        makeChoice(choice) {
            // Apply effects
            if (choice.points) this.state.score += choice.points;
            if (choice.cash) this.state.cash += choice.cash;
            
            // Set flags
            if (choice.setFlag) {
                Object.keys(choice.setFlag).forEach(key => {
                    this.state.flags[key] = choice.setFlag[key];
                });
            }

            // Record history
            this.state.history.push(choice.log || choice.label);
            this.state.step++;

            this.updateUI();

            if (choice.next === 'ENDING') {
                this.endGame(choice.endType);
            } else {
                this.loadScene(choice.next);
            }
        },

        endGame(type) {
            const overlay = document.getElementById('resultOverlay');
            const breakdown = document.getElementById('scoreBreakdown');
            const edu = document.getElementById('educationalText');
            
            overlay.style.display = 'block';
            breakdown.innerHTML = '';

            // Calculate Final Taxes & Fines Logic
            let finalMsg = "";
            let finalDeduction = 0;

            if (type === 'green_caught') {
                finalMsg = "Du wurdest im Gr√ºnen Kanal erwischt! Das ist Steuerhinterziehung.";
                finalDeduction = -1000; // Heavy penalty
                // Add taxes + fine (double taxes)
                const taxes = 300; // Simplified
                this.state.cash -= (taxes * 2); 
            } else if (type === 'red_success') {
                finalMsg = "Du hast den Roten Kanal gew√§hlt.";
                // Calc Taxes
                let taxBase = 0;
                // Laptop (900) is indivisible -> full tax
                // Gold (550) is indivisible -> full tax
                // Only if you have receipts. If not, Zoll estimates higher.
                
                let markup = this.state.flags.has_receipts ? 1.0 : 1.3; // 30% markup if no receipt
                
                taxBase = (900 + 550) * markup; 
                const taxBill = Math.round(taxBase * 0.19); // Simplified 19% EUst
                
                this.state.cash -= taxBill;
                
                this.addLog("Einfuhrabgaben bezahlt", `-${taxBill}‚Ç¨`);
                
                if (!this.state.flags.has_receipts) {
                    this.addLog("Strafe: Fehlende Belege", "-100 Pkt");
                    this.state.score -= 100;
                    finalMsg += " Weil du keine Belege hattest, wurde der Wert gesch√§tzt (teurer!).";
                } else {
                    this.addLog("Vorbildlich: Belege vorhanden", "+200 Pkt");
                    this.state.score += 200;
                    finalMsg += " Mit den Belegen ging die Abfertigung schnell.";
                }
            } else if (type === 'cash_caught') {
                finalMsg = "Du hast bei der Barmittel-Frage gelogen oder wurdest mit zu viel Bargeld erwischt.";
                this.state.score -= 500;
                this.state.cash -= 500; // Fine
            }

            // Build Score breakdown visual
            this.addLog("Basis Punkte", "500");
            this.addLog("Restliches Budget", `+${Math.floor(this.state.cash / 10)} Pkt`); // Convert cash to points
            this.state.score += Math.floor(this.state.cash / 10);

            document.getElementById('finalScoreDisplay').innerText = this.state.score + " Pkt";
            document.getElementById('resultTitle').innerText = finalMsg;

            // Educational Context based on Flags
            let eduHtml = "<strong>Zoll-Wissen:</strong><br><ul>";
            if (this.state.flags.receipts_thrown) eduHtml += "<li><span style='color:red'>Fehler:</span> Wer Belege wegwirft, erschwert die Verzollung. Der Zoll darf den Wert sch√§tzen (oft h√∂her als der Kaufpreis).</li>";
            else eduHtml += "<li><span style='color:green'>Tipp:</span> Kaufbelege immer aufbewahren! Sie sind der Beweis f√ºr den Warenwert.</li>";
            
            if (type.includes('red')) eduHtml += "<li><span style='color:green'>Richtig:</span> Bei Waren √ºber 300‚Ç¨ (Landweg) immer den Roten Kanal nutzen.</li>";
            else eduHtml += "<li><span style='color:red'>Gefahr:</span> Der Gr√ºne Kanal ist eine rechtsverbindliche Erkl√§rung 'Nichts zu verzollen'.</li>";
            
            if (this.state.inventory.find(i => i.name === "Goldkette").val > 430) eduHtml += "<li><span style='color:orange'>Info:</span> Die Goldkette war nicht teilbar. Der gesamte Wert muss versteuert werden, nicht nur der Betrag √ºber 300‚Ç¨.</li>";

            eduHtml += "</ul>";
            edu.innerHTML = eduHtml;
        },

        addLog(label, val) {
            const div = document.createElement('div');
            div.className = 'score-row';
            div.innerHTML = `<span>${label}</span><strong>${val}</strong>`;
            document.getElementById('scoreBreakdown').appendChild(div);
        }
    };

    /**
     * SCENARIOS
     */
    const scenarios = {
        // SCENE 1: SHOPPING
        scene_shop_checkout: {
            title: "An der Kasse in Z√ºrich",
            location: "Elektronik-Markt",
            text: "Du hast gerade einen brandneuen Laptop (900‚Ç¨) und eine Goldkette (550‚Ç¨) gekauft. Der Verk√§ufer fragt: 'Brauchen Sie den Kassenbon oder kann der weg?'",
            choices: [
                { 
                    label: "Beleg mitnehmen", 
                    desc: "Wichtig f√ºr die Garantie... und den Zoll?", 
                    points: 50, 
                    setFlag: { has_receipts: true }, 
                    next: "scene_packing" 
                },
                { 
                    label: "Wegwerfen", 
                    desc: "Ich will keine Beweise in der Tasche.", 
                    points: -50, 
                    setFlag: { has_receipts: false, receipts_thrown: true }, 
                    next: "scene_packing" 
                }
            ]
        },

        // SCENE 2: PACKING STRATEGY
        scene_packing: {
            title: "Am Auto: Packen",
            location: "Parkhaus Z√ºrich",
            text: "Wie verstaust du deine Eink√§ufe? Die Goldkette (550‚Ç¨) gl√§nzt sehr auff√§llig. Die Freigrenze liegt bei 300‚Ç¨ pro Person.",
            choices: [
                { 
                    label: "Ehrlich einpacken", 
                    desc: "Alles in die T√ºten, ab in den Kofferraum.", 
                    points: 50, 
                    setFlag: { wear_jewelry: false }, 
                    next: "scene_drive_talk" 
                },
                { 
                    label: "Kette tragen", 
                    desc: "Ich tue so, als w√§re es meine alte Kette.", 
                    points: -100, // Risk penalty logic applied later
                    setFlag: { wear_jewelry: true }, 
                    next: "scene_drive_talk" 
                },
                { 
                    label: "Alles verstecken", 
                    desc: "Unter dem Reserverad und in der Schmutzw√§sche.", 
                    points: -200, 
                    setFlag: { hide_tech: true, hide_jewelry: true }, 
                    next: "scene_drive_talk" 
                }
            ]
        },

        // SCENE 3: THE DRIVE
        scene_drive_talk: {
            title: "Auf der Autobahn",
            location: "A1 Richtung Konstanz",
            text: "Dein Beifahrer liest im Internet: 'Hey, Fleisch und K√§se darf man doch gar nicht einf√ºhren, oder? Und wie viel Bargeld hast du eigentlich dabei?' Du hast noch das Restgeld vom Casino (9.000‚Ç¨) und dein eigenes Geld (1.500‚Ç¨) in der Tasche. Zusammen √ºber 10.000‚Ç¨.",
            choices: [
                { 
                    label: "Geld aufteilen", 
                    desc: "Gib dem Beifahrer die H√§lfte, damit jeder unter 10k bleibt.", 
                    points: 100, 
                    setFlag: { cash_split: true }, 
                    next: "scene_border_approach" 
                },
                { 
                    label: "Egal, passt schon", 
                    desc: "Wer kontrolliert schon Bargeld?", 
                    points: -50, 
                    setFlag: { cash_split: false }, 
                    next: "scene_border_approach" 
                }
            ]
        },

        // SCENE 4: THE BORDER
        scene_border_approach: {
            title: "Die Entscheidung",
            location: "Grenz√ºbergang",
            text: "Du erreichst die Grenze. <br>Links: <strong>Gr√ºner Kanal</strong> (Anmeldefreie Waren). <br>Rechts: <strong>Roter Kanal</strong> (Anmeldepflichtige Waren).<br>Der Rote Kanal sieht leer aus, beim Gr√ºnen steht ein Beamter, der genau schaut.",
            choices: [
                { 
                    label: "Roter Kanal (Anmelden)", 
                    desc: "Der sichere Weg, aber es kostet Geld.", 
                    points: 200, 
                    next: "scene_red_inspection" 
                },
                { 
                    label: "Gr√ºner Kanal (Risiko)", 
                    desc: "Hoffentlich winken sie mich durch.", 
                    points: -100, // Negative for intent to smuggle items > 300
                    next: "scene_green_inspection" 
                }
            ]
        },

        // SCENE 5: RED LANE LOGIC
        scene_red_inspection: {
            title: "Roter Kanal: Das B√ºro",
            location: "Zollamt",
            text: "Du gehst zum Schalter. Der Beamte fragt: 'Was haben wir denn hier?' Du legst Laptop und Kette auf den Tisch. 'Haben Sie die Kaufbelege?'",
            choices: [
                { 
                    label: "Hier sind die Belege", 
                    condition: (s) => s.flags.has_receipts,
                    desc: "Alles korrekt dokumentiert.", 
                    points: 100, 
                    next: "scene_red_payment" 
                },
                { 
                    label: "√Ñh, nein... weggeworfen", 
                    condition: (s) => !s.flags.has_receipts,
                    desc: "Der Beamte seufzt und holt eine Liste raus.", 
                    points: -100, 
                    next: "scene_red_estimation" 
                }
            ]
        },

        scene_red_payment: {
            title: "Die Abrechnung",
            location: "Zollamt",
            text: "Der Beamte tippt in den Rechner. 'Alles klar. Sie zahlen die Einfuhrumsatzsteuer. Da Sie ehrlich waren, ist das alles schnell erledigt.'",
            choices: [{ label: "Bezahlen und weiter", next: "ENDING", endType: "red_success" }]
        },

        scene_red_estimation: {
            title: "Die Sch√§tzung",
            location: "Zollamt",
            text: "Ohne Beleg sucht der Beamte die Preise im Internet. Er findet den Laptop nur in einer teureren Version (1100‚Ç¨) und nimmt diesen als Basis. 'Das wird teurer als n√∂tig', murmelt er.",
            choices: [{ label: "Z√§hneknirschend akzeptieren", points: -50, next: "ENDING", endType: "red_success" }]
        },

        // SCENE 6: GREEN LANE LOGIC
        scene_green_inspection: {
            title: "Gr√ºner Kanal",
            location: "Fahrbahn",
            text: "Du f√§hrst langsam. Der Beamte schaut dir tief in die Augen. Er hebt die Kelle. 'Guten Tag, Zollkontrolle. Woher kommen Sie? Haben Sie Waren anzumelden?'",
            choices: [
                { 
                    label: "Nichts anzumelden", 
                    desc: "Die klassische L√ºge.", 
                    points: -200, 
                    next: "scene_green_search" 
                },
                { 
                    label: "Okay, ich habe doch was...", 
                    desc: "Sp√§te Reue (Nachmeldung).", 
                    points: 50, 
                    next: "scene_late_confession" 
                }
            ]
        },

        scene_green_search: {
            title: "Die Kontrolle",
            location: "Kontrollgarage",
            text: "'Bitte Kofferraum auf.' Der Beamte sieht die T√ºten. Falls du Dinge versteckt hast, holt er jetzt den Schraubenzieher oder den Drogensp√ºrhund (f√ºr Bargeld).",
            choices: [
                { 
                    label: "Abwarten...", 
                    desc: "Hoffentlich finden sie die Kette nicht.", 
                    next: "scene_green_result" 
                }
            ]
        },

        scene_green_result: {
            title: "Der Fund",
            location: "Kontrollgarage",
            text: "Nat√ºrlich finden sie alles. 'Sie sind durch Gr√ºn gefahren. Das ist ein Steuervergehen.' Zudem finden sie das Bargeld (>10.000‚Ç¨ ungeteilt?).",
            choices: [
                { 
                    label: "Verdammt.", 
                    next: "ENDING", 
                    endType: "green_caught" 
                }
            ]
        },
        
        scene_late_confession: {
            title: "Gerade noch so",
            location: "Gr√ºner Kanal",
            text: "Der Beamte schaut streng. 'Eigentlich zu sp√§t, da Sie schon im Kanal sind. Aber ich dr√ºcke ein Auge zu und berechne nur den doppelten Satz ohne Strafanzeige.'",
            choices: [
                { label: "Gl√ºck gehabt", points: -100, cash: -100, next: "ENDING", endType: "red_success" } // Acts like red but more expensive
            ]
        }
    };

    // Start
    game.init();

</script>
</body>
</html>


